{"ast":null,"code":"import _asyncToGenerator from \"C:/SpringBOot/ecommerce-project/03-frontend/angular-ecommerce/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { BroadcastChannel } from 'broadcast-channel';\nimport { isBrowser } from '../features.js';\nimport '../oidc/types/Token.js';\nimport { EVENT_ADDED, EVENT_REMOVED, EVENT_RENEWED, EVENT_SET_STORAGE } from '../oidc/types/TokenManager.js';\nimport AuthSdkError from '../errors/AuthSdkError.js';\nimport '../errors/WWWAuthError.js';\nclass SyncStorageService {\n  constructor(tokenManager, options = {}) {\n    this.started = false;\n    this.enablePostMessage = true;\n    this.tokenManager = tokenManager;\n    this.options = options;\n    this.onTokenAddedHandler = this.onTokenAddedHandler.bind(this);\n    this.onTokenRemovedHandler = this.onTokenRemovedHandler.bind(this);\n    this.onTokenRenewedHandler = this.onTokenRenewedHandler.bind(this);\n    this.onSetStorageHandler = this.onSetStorageHandler.bind(this);\n    this.onSyncMessageHandler = this.onSyncMessageHandler.bind(this);\n  }\n  requiresLeadership() {\n    return false;\n  }\n  isStarted() {\n    return this.started;\n  }\n  canStart() {\n    return !!this.options.syncStorage && isBrowser() && !this.started;\n  }\n  start() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (!_this.canStart()) {\n        return;\n      }\n      const {\n        syncChannelName\n      } = _this.options;\n      try {\n        _this.channel = new BroadcastChannel(syncChannelName);\n      } catch (err) {\n        throw new AuthSdkError('SyncStorageService is not supported in current browser.');\n      }\n      _this.tokenManager.on(EVENT_ADDED, _this.onTokenAddedHandler);\n      _this.tokenManager.on(EVENT_REMOVED, _this.onTokenRemovedHandler);\n      _this.tokenManager.on(EVENT_RENEWED, _this.onTokenRenewedHandler);\n      _this.tokenManager.on(EVENT_SET_STORAGE, _this.onSetStorageHandler);\n      _this.channel.addEventListener('message', _this.onSyncMessageHandler);\n      _this.started = true;\n    })();\n  }\n  stop() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      var _a, _b;\n      if (_this2.started) {\n        _this2.tokenManager.off(EVENT_ADDED, _this2.onTokenAddedHandler);\n        _this2.tokenManager.off(EVENT_REMOVED, _this2.onTokenRemovedHandler);\n        _this2.tokenManager.off(EVENT_RENEWED, _this2.onTokenRenewedHandler);\n        _this2.tokenManager.off(EVENT_SET_STORAGE, _this2.onSetStorageHandler);\n        (_a = _this2.channel) === null || _a === void 0 ? void 0 : _a.removeEventListener('message', _this2.onSyncMessageHandler);\n        yield (_b = _this2.channel) === null || _b === void 0 ? void 0 : _b.close();\n        _this2.channel = undefined;\n        _this2.started = false;\n      }\n    })();\n  }\n  onTokenAddedHandler(key, token) {\n    var _a;\n    if (!this.enablePostMessage) {\n      return;\n    }\n    (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n      type: EVENT_ADDED,\n      key,\n      token\n    });\n  }\n  onTokenRemovedHandler(key, token) {\n    var _a;\n    if (!this.enablePostMessage) {\n      return;\n    }\n    (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n      type: EVENT_REMOVED,\n      key,\n      token\n    });\n  }\n  onTokenRenewedHandler(key, token, oldToken) {\n    var _a;\n    if (!this.enablePostMessage) {\n      return;\n    }\n    (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n      type: EVENT_RENEWED,\n      key,\n      token,\n      oldToken\n    });\n  }\n  onSetStorageHandler(storage) {\n    var _a;\n    (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n      type: EVENT_SET_STORAGE,\n      storage\n    });\n  }\n  onSyncMessageHandler(msg) {\n    this.enablePostMessage = false;\n    switch (msg.type) {\n      case EVENT_SET_STORAGE:\n        this.tokenManager.getStorage().setStorage(msg.storage);\n        break;\n      case EVENT_ADDED:\n        this.tokenManager.emitAdded(msg.key, msg.token);\n        this.tokenManager.setExpireEventTimeout(msg.key, msg.token);\n        break;\n      case EVENT_REMOVED:\n        this.tokenManager.clearExpireEventTimeout(msg.key);\n        this.tokenManager.emitRemoved(msg.key, msg.token);\n        break;\n      case EVENT_RENEWED:\n        this.tokenManager.emitRenewed(msg.key, msg.token, msg.oldToken);\n        break;\n    }\n    this.enablePostMessage = true;\n  }\n}\nexport { SyncStorageService };","map":{"version":3,"names":["BroadcastChannel","isBrowser","EVENT_ADDED","EVENT_REMOVED","EVENT_RENEWED","EVENT_SET_STORAGE","AuthSdkError","SyncStorageService","constructor","tokenManager","options","started","enablePostMessage","onTokenAddedHandler","bind","onTokenRemovedHandler","onTokenRenewedHandler","onSetStorageHandler","onSyncMessageHandler","requiresLeadership","isStarted","canStart","syncStorage","start","_this","_asyncToGenerator","syncChannelName","channel","err","on","addEventListener","stop","_this2","_a","_b","off","removeEventListener","close","undefined","key","token","postMessage","type","oldToken","storage","msg","getStorage","setStorage","emitAdded","setExpireEventTimeout","clearExpireEventTimeout","emitRemoved","emitRenewed"],"sources":["C:/SpringBOot/ecommerce-project/03-frontend/angular-ecommerce/node_modules/@okta/okta-auth-js/esm/browser/services/SyncStorageService.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { BroadcastChannel } from 'broadcast-channel';\nimport { isBrowser } from '../features.js';\nimport '../oidc/types/Token.js';\nimport { EVENT_ADDED, EVENT_REMOVED, EVENT_RENEWED, EVENT_SET_STORAGE } from '../oidc/types/TokenManager.js';\nimport AuthSdkError from '../errors/AuthSdkError.js';\nimport '../errors/WWWAuthError.js';\n\nclass SyncStorageService {\n    constructor(tokenManager, options = {}) {\n        this.started = false;\n        this.enablePostMessage = true;\n        this.tokenManager = tokenManager;\n        this.options = options;\n        this.onTokenAddedHandler = this.onTokenAddedHandler.bind(this);\n        this.onTokenRemovedHandler = this.onTokenRemovedHandler.bind(this);\n        this.onTokenRenewedHandler = this.onTokenRenewedHandler.bind(this);\n        this.onSetStorageHandler = this.onSetStorageHandler.bind(this);\n        this.onSyncMessageHandler = this.onSyncMessageHandler.bind(this);\n    }\n    requiresLeadership() {\n        return false;\n    }\n    isStarted() {\n        return this.started;\n    }\n    canStart() {\n        return !!this.options.syncStorage && isBrowser() && !this.started;\n    }\n    async start() {\n        if (!this.canStart()) {\n            return;\n        }\n        const { syncChannelName } = this.options;\n        try {\n            this.channel = new BroadcastChannel(syncChannelName);\n        }\n        catch (err) {\n            throw new AuthSdkError('SyncStorageService is not supported in current browser.');\n        }\n        this.tokenManager.on(EVENT_ADDED, this.onTokenAddedHandler);\n        this.tokenManager.on(EVENT_REMOVED, this.onTokenRemovedHandler);\n        this.tokenManager.on(EVENT_RENEWED, this.onTokenRenewedHandler);\n        this.tokenManager.on(EVENT_SET_STORAGE, this.onSetStorageHandler);\n        this.channel.addEventListener('message', this.onSyncMessageHandler);\n        this.started = true;\n    }\n    async stop() {\n        var _a, _b;\n        if (this.started) {\n            this.tokenManager.off(EVENT_ADDED, this.onTokenAddedHandler);\n            this.tokenManager.off(EVENT_REMOVED, this.onTokenRemovedHandler);\n            this.tokenManager.off(EVENT_RENEWED, this.onTokenRenewedHandler);\n            this.tokenManager.off(EVENT_SET_STORAGE, this.onSetStorageHandler);\n            (_a = this.channel) === null || _a === void 0 ? void 0 : _a.removeEventListener('message', this.onSyncMessageHandler);\n            await ((_b = this.channel) === null || _b === void 0 ? void 0 : _b.close());\n            this.channel = undefined;\n            this.started = false;\n        }\n    }\n    onTokenAddedHandler(key, token) {\n        var _a;\n        if (!this.enablePostMessage) {\n            return;\n        }\n        (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n            type: EVENT_ADDED,\n            key,\n            token\n        });\n    }\n    onTokenRemovedHandler(key, token) {\n        var _a;\n        if (!this.enablePostMessage) {\n            return;\n        }\n        (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n            type: EVENT_REMOVED,\n            key,\n            token\n        });\n    }\n    onTokenRenewedHandler(key, token, oldToken) {\n        var _a;\n        if (!this.enablePostMessage) {\n            return;\n        }\n        (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n            type: EVENT_RENEWED,\n            key,\n            token,\n            oldToken\n        });\n    }\n    onSetStorageHandler(storage) {\n        var _a;\n        (_a = this.channel) === null || _a === void 0 ? void 0 : _a.postMessage({\n            type: EVENT_SET_STORAGE,\n            storage\n        });\n    }\n    onSyncMessageHandler(msg) {\n        this.enablePostMessage = false;\n        switch (msg.type) {\n            case EVENT_SET_STORAGE:\n                this.tokenManager.getStorage().setStorage(msg.storage);\n                break;\n            case EVENT_ADDED:\n                this.tokenManager.emitAdded(msg.key, msg.token);\n                this.tokenManager.setExpireEventTimeout(msg.key, msg.token);\n                break;\n            case EVENT_REMOVED:\n                this.tokenManager.clearExpireEventTimeout(msg.key);\n                this.tokenManager.emitRemoved(msg.key, msg.token);\n                break;\n            case EVENT_RENEWED:\n                this.tokenManager.emitRenewed(msg.key, msg.token, msg.oldToken);\n                break;\n        }\n        this.enablePostMessage = true;\n    }\n}\n\nexport { SyncStorageService };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}